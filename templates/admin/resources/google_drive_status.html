{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}Google Drive Status{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:resources_resource_changelist' %}">Resources</a>
    &rsaquo; Google Drive Status
</div>
{% endblock %}

{% block content %}
<div class="module aligned">
    <h1>Google Drive Integration Status</h1>
    
    <fieldset class="module aligned">
        <h2>Configuration</h2>
        
        <div class="form-row">
            <label>Google Drive Configured:</label>
            <div>
                {% if google_drive_configured %}
                    <span style="color: green; font-weight: bold;">✓ Yes</span>
                    <p class="help">Google Drive API credentials are configured.</p>
                {% else %}
                    <span style="color: red; font-weight: bold;">✗ No</span>
                    <p class="help">
                        Google Drive API is not configured. Please set the following environment variables:<br>
                        - GOOGLE_DRIVE_STORAGE_JSON_KEY_FILE<br>
                        - GOOGLE_DRIVE_FOLDER_ID
                    </p>
                {% endif %}
            </div>
        </div>
        
        {% if google_drive_folder_id %}
        <div class="form-row">
            <label>Drive Folder ID:</label>
            <div>
                <code>{{ google_drive_folder_id }}</code>
                <p class="help">
                    <a href="https://drive.google.com/drive/folders/{{ google_drive_folder_id }}" target="_blank">
                        View folder in Google Drive
                    </a>
                </p>
            </div>
        </div>
        {% endif %}
    </fieldset>
    
    <fieldset class="module aligned">
        <h2>Storage Statistics</h2>
        
        <div class="form-row">
            <label>Total Resources:</label>
            <div><strong>{{ total_resources }}</strong></div>
        </div>
        
        <div class="form-row">
            <label>Resources on Google Drive:</label>
            <div>
                <strong>{{ resources_on_drive }}</strong>
                {% if total_resources > 0 %}
                    ({{ resources_on_drive|floatformat:0 }}% of total)
                {% endif %}
            </div>
        </div>
        
        <div class="form-row">
            <label>Local Only Resources:</label>
            <div>
                <strong>{{ resources_local_only }}</strong>
                {% if total_resources > 0 %}
                    ({{ resources_local_only|floatformat:0 }}% of total)
                {% endif %}
            </div>
        </div>
    </fieldset>
    
    {% if google_drive_configured %}
    <fieldset class="module aligned">
        <h2>Actions</h2>
        
        <div class="form-row">
            <div>
                <a href="{% url 'admin:resources_resource_changelist' %}?google_drive_file_id__isnull=True&local_file__isnull=False" 
                   class="button">
                    View Resources Pending Drive Upload
                </a>
                <p class="help">Show all resources that are stored locally but not yet uploaded to Google Drive.</p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <a href="{% url 'admin:resources_resource_changelist' %}?google_drive_file_id__isnull=False" 
                   class="button">
                    View Resources on Google Drive
                </a>
                <p class="help">Show all resources that are stored on Google Drive.</p>
            </div>
        </div>
    </fieldset>
    {% endif %}
    
    <fieldset class="module aligned">
        <h2>Google Drive Setup Instructions</h2>
        
        <div class="help">
            <p><strong>To configure Google Drive integration:</strong></p>
            <ol>
                <li>Go to the <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a></li>
                <li>Create a new project or select an existing one</li>
                <li>Enable the Google Drive API</li>
                <li>Create a service account and download the JSON key file</li>
                <li>Share your Google Drive folder with the service account email</li>
                <li>Set the environment variables:
                    <ul>
                        <li><code>GOOGLE_DRIVE_STORAGE_JSON_KEY_FILE</code> - Path to the JSON key file</li>
                        <li><code>GOOGLE_DRIVE_FOLDER_ID</code> - The folder ID from Google Drive URL</li>
                    </ul>
                </li>
                <li>Restart the Django application</li>
            </ol>
        </div>
    </fieldset>
    
    <div class="submit-row">
        <a href="{% url 'admin:resources_resource_changelist' %}" class="button cancel-link">Back to Resources</a>
    </div>
</div>
{% endblock %}
