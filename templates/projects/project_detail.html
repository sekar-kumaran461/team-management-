{% extends 'base.html' %}
{% load static %}

{% block title %}{{ project.name }} - TeamLearn{% endblock %}

{% block extra_css %}
<style>
    .project-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .metric-card {
        transition: all 0.3s ease;
    }
    
    .metric-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
    }
    
    .task-item {
        transition: all 0.3s ease;
    }
    
    .task-item:hover {
        transform: translateX(4px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .progress-circle {
        transform: rotate(-90deg);
    }
    
    .team-member-avatar {
        transition: all 0.3s ease;
    }
    
    .team-member-avatar:hover {
        transform: scale(1.1);
        z-index: 10;
    }
</style>
{% endblock %}

{% block content %}
<div x-data="projectDetail()" class="min-h-screen bg-gray-50">
    <!-- Project Header -->
    <div class="project-header text-white relative overflow-hidden">
        <div class="absolute inset-0 bg-black opacity-10"></div>
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <!-- Breadcrumb -->
            <nav class="mb-8">
                <ol class="flex items-center space-x-4 text-white text-opacity-80">
                    <li>
                        <a href="{% url 'projects:project-list' %}" class="hover:text-white transition-colors duration-200">
                            <i class="fas fa-project-diagram mr-2"></i>Projects
                        </a>
                    </li>
                    <li class="flex items-center">
                        <i class="fas fa-chevron-right mx-3"></i>
                        <span class="text-white">{{ project.name }}</span>
                    </li>
                </ol>
            </nav>

            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between">
                <div class="flex-1 mb-6 lg:mb-0">
                    <div class="flex items-start space-x-4 mb-4">
                        <div class="flex-shrink-0">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                                <i class="fas fa-rocket text-2xl"></i>
                            </div>
                        </div>
                        <div>
                            <h1 class="text-4xl font-bold mb-2">{{ project.name }}</h1>
                            <p class="text-xl text-white text-opacity-90 mb-4 max-w-3xl">{{ project.description|default:"No description provided" }}</p>
                            
                            <div class="flex flex-wrap items-center gap-6">
                                <div class="flex items-center">
                                    <i class="fas fa-user mr-2"></i>
                                    <span>Created by {{ project.created_by.full_name }}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-calendar-plus mr-2"></i>
                                    <span>{{ project.created_at|date:"M d, Y" }}</span>
                                </div>
                                {% if project.deadline %}
                                <div class="flex items-center">
                                    <i class="fas fa-flag-checkered mr-2"></i>
                                    <span>Due {{ project.deadline|date:"M d, Y" }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4">
                    {% if user.is_admin or project.created_by == user %}
                    <button @click="editProject" class="px-6 py-3 bg-white bg-opacity-20 text-white rounded-lg border border-white border-opacity-30 hover:bg-opacity-30 transition-all duration-300">
                        <i class="fas fa-edit mr-2"></i>Edit Project
                    </button>
                    {% endif %}
                    
                    <button @click="addTask" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-300">
                        <i class="fas fa-plus mr-2"></i>Add Task
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Stats -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-8 relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-tasks text-blue-600 text-xl"></i>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-1" x-text="stats.totalTasks"></div>
                <div class="text-sm text-gray-500">Total Tasks</div>
            </div>
            
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-check-circle text-green-600 text-xl"></i>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-1" x-text="stats.completedTasks"></div>
                <div class="text-sm text-gray-500">Completed</div>
            </div>
            
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-clock text-yellow-600 text-xl"></i>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-1" x-text="stats.inProgress"></div>
                <div class="text-sm text-gray-500">In Progress</div>
            </div>
            
            <div class="metric-card bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-users text-purple-600 text-xl"></i>
                </div>
                <div class="text-2xl font-bold text-gray-900 mb-1" x-text="stats.teamMembers"></div>
                <div class="text-sm text-gray-500">Team Members</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Progress Overview -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900">
                            <i class="fas fa-chart-line mr-2 text-primary-500"></i>Progress Overview
                        </h2>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-900" x-text="overallProgress + '%'"></div>
                                <div class="text-sm text-gray-500">Complete</div>
                            </div>
                            <div class="relative w-16 h-16">
                                <svg class="w-16 h-16 progress-circle">
                                    <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="6" fill="none"></circle>
                                    <circle cx="32" cy="32" r="28" stroke="#6366f1" stroke-width="6" fill="none"
                                            stroke-dasharray="175.93" :stroke-dashoffset="175.93 - (175.93 * overallProgress / 100)"
                                            class="transition-all duration-500"></circle>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span class="text-sm font-bold text-gray-900" x-text="overallProgress + '%'"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-lg font-semibold text-green-600" x-text="stats.completedTasks"></div>
                            <div class="text-sm text-gray-500">Completed</div>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-lg font-semibold text-yellow-600" x-text="stats.inProgress"></div>
                            <div class="text-sm text-gray-500">In Progress</div>
                        </div>
                        <div class="text-center p-4 bg-gray-50 rounded-lg">
                            <div class="text-lg font-semibold text-red-600" x-text="stats.overdue"></div>
                            <div class="text-sm text-gray-500">Overdue</div>
                        </div>
                    </div>
                </div>

                <!-- Tasks List -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-900">
                            <i class="fas fa-list-check mr-2 text-primary-500"></i>Project Tasks
                        </h2>
                        <div class="flex items-center space-x-3">
                            <select x-model="taskFilter" @change="filterTasks" class="text-sm border border-gray-300 rounded-lg px-3 py-1">
                                <option value="all">All Tasks</option>
                                <option value="pending">Pending</option>
                                <option value="in_progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="overdue">Overdue</option>
                            </select>
                            <button @click="addTask" class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-300">
                                <i class="fas fa-plus mr-1"></i>Add Task
                            </button>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <template x-for="task in filteredTasks" :key="task.id">
                            <div class="task-item border border-gray-200 rounded-lg p-4 hover:border-primary-300 transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0">
                                            <div class="w-8 h-8 rounded-full flex items-center justify-center"
                                                 :class="{
                                                     'bg-green-100': task.status === 'completed',
                                                     'bg-yellow-100': task.status === 'in_progress',
                                                     'bg-red-100': task.status === 'overdue',
                                                     'bg-gray-100': task.status === 'pending'
                                                 }">
                                                <i :class="{
                                                       'fas fa-check text-green-600': task.status === 'completed',
                                                       'fas fa-play text-yellow-600': task.status === 'in_progress',
                                                       'fas fa-exclamation text-red-600': task.status === 'overdue',
                                                       'fas fa-circle text-gray-400': task.status === 'pending'
                                                   }" class="text-sm"></i>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 class="font-medium text-gray-900" x-text="task.title"></h3>
                                            <div class="flex items-center space-x-4 mt-1">
                                                <span class="text-sm text-gray-500" x-text="task.assigned_to"></span>
                                                <span class="text-sm text-gray-500" x-text="task.due_date"></span>
                                                <span class="text-xs px-2 py-1 rounded-full"
                                                      :class="{
                                                          'bg-red-100 text-red-800': task.priority === 'high',
                                                          'bg-yellow-100 text-yellow-800': task.priority === 'medium',
                                                          'bg-green-100 text-green-800': task.priority === 'low'
                                                      }" x-text="task.priority + ' priority'"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button @click="viewTask(task.id)" class="text-primary-600 hover:text-primary-700">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button @click="editTask(task.id)" class="text-gray-600 hover:text-gray-700">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- No tasks state -->
                        <div x-show="filteredTasks.length === 0" class="text-center py-12">
                            <i class="fas fa-tasks text-4xl text-gray-300 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">No tasks found</h3>
                            <p class="text-gray-500 mb-4">Get started by creating your first task for this project.</p>
                            <button @click="addTask" class="px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-300">
                                <i class="fas fa-plus mr-2"></i>Create Task
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">
                        <i class="fas fa-history mr-2 text-primary-500"></i>Recent Activity
                    </h2>
                    <div class="space-y-4">
                        <template x-for="activity in recentActivity" :key="activity.id">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center">
                                        <i :class="activity.icon" class="text-primary-600 text-sm"></i>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm text-gray-900" x-text="activity.description"></p>
                                    <p class="text-xs text-gray-500" x-text="activity.timestamp"></p>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="space-y-6">
                <!-- Project Info -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-info-circle mr-2 text-primary-500"></i>Project Details
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-sm font-medium text-gray-500">Status</label>
                            <div class="mt-1">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
                                      :class="{
                                          'bg-green-100 text-green-800': '{{ project.status }}' === 'completed',
                                          'bg-yellow-100 text-yellow-800': '{{ project.status }}' === 'in_progress',
                                          'bg-blue-100 text-blue-800': '{{ project.status }}' === 'planning',
                                          'bg-gray-100 text-gray-800': '{{ project.status }}' === 'on_hold'
                                      }">
                                    {{ project.get_status_display }}
                                </span>
                            </div>
                        </div>
                        
                        {% if project.deadline %}
                        <div>
                            <label class="text-sm font-medium text-gray-500">Deadline</label>
                            <div class="mt-1 text-sm text-gray-900">{{ project.deadline|date:"M d, Y" }}</div>
                        </div>
                        {% endif %}
                        
                        <div>
                            <label class="text-sm font-medium text-gray-500">Budget</label>
                            <div class="mt-1 text-sm text-gray-900">${{ project.budget|default:"Not set" }}</div>
                        </div>
                        
                        <div>
                            <label class="text-sm font-medium text-gray-500">Priority</label>
                            <div class="mt-1">
                                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium"
                                      :class="{
                                          'bg-red-100 text-red-800': '{{ project.priority }}' === 'high',
                                          'bg-yellow-100 text-yellow-800': '{{ project.priority }}' === 'medium',
                                          'bg-green-100 text-green-800': '{{ project.priority }}' === 'low'
                                      }">
                                    {{ project.get_priority_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Team Members -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-users mr-2 text-primary-500"></i>Team Members
                    </h3>
                    <div class="space-y-3">
                        <template x-for="member in teamMembers" :key="member.id">
                            <div class="flex items-center space-x-3">
                                <div class="team-member-avatar w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-primary-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900" x-text="member.name"></p>
                                    <p class="text-xs text-gray-500" x-text="member.role"></p>
                                </div>
                                <div class="text-xs text-gray-400" x-text="member.tasks_count + ' tasks'"></div>
                            </div>
                        </template>
                        
                        <button @click="inviteMembers" class="w-full mt-4 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors duration-300">
                            <i class="fas fa-user-plus mr-2"></i>Invite Members
                        </button>
                    </div>
                </div>

                <!-- Project Files -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-folder mr-2 text-primary-500"></i>Project Files
                    </h3>
                    <div class="space-y-3">
                        <template x-for="file in projectFiles" :key="file.id">
                            <div class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg">
                                <i class="fas fa-file text-gray-400"></i>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-gray-900" x-text="file.name"></p>
                                    <p class="text-xs text-gray-500" x-text="file.size + ' • ' + file.uploaded_at"></p>
                                </div>
                                <button class="text-primary-600 hover:text-primary-700">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </template>
                        
                        <button @click="uploadFile" class="w-full mt-4 px-4 py-2 border border-dashed border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:border-primary-400 hover:text-primary-600 transition-colors duration-300">
                            <i class="fas fa-cloud-upload-alt mr-2"></i>Upload Files
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function projectDetail() {
    return {
        stats: {
            totalTasks: {{ project.tasks.count }},
            completedTasks: {{ project.tasks.filter.status.completed.count|default:0 }},
            inProgress: {{ project.tasks.filter.status.in_progress.count|default:0 }},
            overdue: 2,
            teamMembers: 5
        },
        overallProgress: 68,
        taskFilter: 'all',
        tasks: [
            {
                id: 1,
                title: 'Design User Interface',
                assigned_to: 'John Doe',
                due_date: 'Dec 15',
                priority: 'high',
                status: 'in_progress'
            },
            {
                id: 2,
                title: 'Setup Database',
                assigned_to: 'Jane Smith',
                due_date: 'Dec 10',
                priority: 'medium',
                status: 'completed'
            },
            {
                id: 3,
                title: 'Write Documentation',
                assigned_to: 'Mike Johnson',
                due_date: 'Dec 20',
                priority: 'low',
                status: 'pending'
            }
        ],
        filteredTasks: [],
        teamMembers: [
            { id: 1, name: 'John Doe', role: 'Developer', tasks_count: 5 },
            { id: 2, name: 'Jane Smith', role: 'Designer', tasks_count: 3 },
            { id: 3, name: 'Mike Johnson', role: 'PM', tasks_count: 7 }
        ],
        projectFiles: [
            { id: 1, name: 'project-spec.pdf', size: '2.5 MB', uploaded_at: '2 days ago' },
            { id: 2, name: 'wireframes.sketch', size: '15.2 MB', uploaded_at: '1 week ago' }
        ],
        recentActivity: [
            {
                id: 1,
                description: 'John Doe completed "Setup Database" task',
                timestamp: '2 hours ago',
                icon: 'fas fa-check'
            },
            {
                id: 2,
                description: 'New task "Write Tests" was created',
                timestamp: '1 day ago',
                icon: 'fas fa-plus'
            }
        ],
        
        init() {
            this.filteredTasks = this.tasks;
            this.calculateProgress();
        },
        
        calculateProgress() {
            if (this.stats.totalTasks > 0) {
                this.overallProgress = Math.round((this.stats.completedTasks / this.stats.totalTasks) * 100);
            }
        },
        
        filterTasks() {
            if (this.taskFilter === 'all') {
                this.filteredTasks = this.tasks;
            } else {
                this.filteredTasks = this.tasks.filter(task => task.status === this.taskFilter);
            }
        },
        
        addTask() {
            window.location.href = '/tasks/create/?project={{ project.id }}';
        },
        
        viewTask(taskId) {
            window.location.href = `/tasks/${taskId}/`;
        },
        
        editTask(taskId) {
            window.location.href = `/tasks/${taskId}/edit/`;
        },
        
        editProject() {
            window.location.href = '/projects/{{ project.id }}/edit/';
        },
        
        inviteMembers() {
            alert('Invite members functionality coming soon!');
        },
        
        uploadFile() {
            alert('File upload functionality coming soon!');
        }
    }
}
</script>
{% endblock %}
