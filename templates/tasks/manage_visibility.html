{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Visibility - {{ task.title }}{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <nav class="flex items-center space-x-2 text-sm text-gray-500 mb-4">
                <a href="{% url 'tasks:task-list' %}" class="hover:text-gray-700">Tasks</a>
                <i class="fas fa-chevron-right text-xs"></i>
                <a href="{% url 'tasks:task-detail' task.id %}" class="hover:text-gray-700">{{ task.title|truncatechars:50 }}</a>
                <i class="fas fa-chevron-right text-xs"></i>
                <span class="text-gray-900">Manage Visibility</span>
            </nav>
            
            <div class="flex items-start justify-between">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900 mb-2">Manage Task Visibility</h1>
                    <p class="text-gray-600">Control who can see and access this task</p>
                </div>
                <a href="{% url 'tasks:task-detail' task.id %}" 
                   class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to Task
                </a>
            </div>
        </div>

        <!-- Current Visibility Status -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                <i class="fas fa-eye text-blue-600 mr-2"></i>
                Current Visibility Status
            </h2>
            
            <div class="bg-gray-50 rounded-lg p-4">
                {% if current_visibility.is_public %}
                    <div class="flex items-center text-green-600">
                        <i class="fas fa-globe text-lg mr-3"></i>
                        <span class="font-medium">Public - Visible to All Team Members</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">All active users can view and submit this task</p>
                {% elif current_visibility.is_private %}
                    <div class="flex items-center text-blue-600">
                        <i class="fas fa-lock text-lg mr-3"></i>
                        <span class="font-medium">Private - Assigned User Only</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">Only the assigned user can view and submit this task</p>
                {% else %}
                    <div class="flex items-center text-orange-600">
                        <i class="fas fa-user-shield text-lg mr-3"></i>
                        <span class="font-medium">Team Leads Only</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">Only team leads and administrators can view this task</p>
                {% endif %}
            </div>
        </div>

        <!-- Visibility Options -->
        <div class="space-y-6">
            
            <!-- Public Visibility -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-start justify-between">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4 mt-1">
                            <i class="fas fa-globe text-green-600 text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Public to All Team Members</h3>
                            <p class="text-gray-600 mb-4">Make this task visible and submittable by all active users</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>All users can view</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>All users can submit</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Great for learning tasks</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Encourages collaboration</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="visibility_type" value="public">
                        <button type="submit" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700 transition-colors"
                                {% if current_visibility.is_public %}disabled{% endif %}>
                            <i class="fas fa-globe mr-2"></i>
                            {% if current_visibility.is_public %}Currently Public{% else %}Make Public{% endif %}
                        </button>
                    </form>
                </div>
            </div>

            <!-- Private Visibility -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-start justify-between">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4 mt-1">
                            <i class="fas fa-lock text-blue-600 text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Private to Assigned User</h3>
                            <p class="text-gray-600 mb-4">Only the assigned user can view and work on this task</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Individual responsibility</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Focused work environment</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Clear accountability</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Confidential tasks</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="visibility_type" value="private">
                        <button type="submit" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors"
                                {% if current_visibility.is_private %}disabled{% endif %}>
                            <i class="fas fa-lock mr-2"></i>
                            {% if current_visibility.is_private %}Currently Private{% else %}Make Private{% endif %}
                        </button>
                    </form>
                </div>
            </div>

            <!-- Team Leads Only -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-start justify-between">
                    <div class="flex items-start">
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4 mt-1">
                            <i class="fas fa-user-shield text-orange-600 text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Team Leads & Admins Only</h3>
                            <p class="text-gray-600 mb-4">Restrict visibility to team leads and administrators only</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Management tasks</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Administrative work</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Strategic planning</span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-check text-green-500 mr-2"></i>
                                    <span>Sensitive information</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <form method="post" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="visibility_type" value="team_leads">
                        <button type="submit" 
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-orange-600 hover:bg-orange-700 transition-colors"
                                {% if current_visibility.is_team_leads %}disabled{% endif %}>
                            <i class="fas fa-user-shield mr-2"></i>
                            {% if current_visibility.is_team_leads %}Currently Restricted{% else %}Restrict Access{% endif %}
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Important Notes -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mt-6">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-600 text-xl mr-3 mt-1"></i>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Important Notes</h3>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-yellow-600 mr-2 mt-1 text-xs"></i>
                            <span>Changing visibility will affect who can view and submit this task</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-yellow-600 mr-2 mt-1 text-xs"></i>
                            <span>Existing submissions will remain accessible to the task creator and reviewers</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-yellow-600 mr-2 mt-1 text-xs"></i>
                            <span>Task creators and administrators can always view all tasks regardless of visibility settings</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add confirmation for critical actions
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
        form.addEventListener('submit', function(e) {
            const visibilityType = form.querySelector('input[name="visibility_type"]').value;
            let message = '';
            
            if (visibilityType === 'public') {
                message = 'This will make the task visible to all team members. Continue?';
            } else if (visibilityType === 'private') {
                message = 'This will restrict the task to the assigned user only. Continue?';
            } else if (visibilityType === 'team_leads') {
                message = 'This will restrict the task to team leads and admins only. Continue?';
            }
            
            if (message) {
                const confirmed = confirm(message);
                if (!confirmed) {
                    e.preventDefault();
                }
            }
        });
    });
});
</script>
{% endblock %}
